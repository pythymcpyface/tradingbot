// Production Prisma schema - Minimal tables for live trading only
// Excludes heavy backtest and optimization tables

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Essential market data for Glicko calculations
model Klines {
  id                      String   @id @default(cuid())
  symbol                  String
  openTime                DateTime
  closeTime               DateTime
  open                    Decimal  @db.Decimal(20, 8)
  high                    Decimal  @db.Decimal(20, 8)
  low                     Decimal  @db.Decimal(20, 8)
  close                   Decimal  @db.Decimal(20, 8)
  volume                  Decimal  @db.Decimal(20, 8)
  quoteAssetVolume        Decimal  @db.Decimal(20, 8)
  numberOfTrades          Int
  takerBuyBaseAssetVolume Decimal  @db.Decimal(20, 8)
  takerBuyQuoteAssetVolume Decimal @db.Decimal(20, 8)
  ignore                  Decimal  @db.Decimal(20, 8)
  createdAt               DateTime @default(now())

  @@unique([symbol, openTime])
  @@index([symbol, openTime])
  @@index([openTime])
  @@map("klines")
}

// Glicko ratings for trading signals
model GlickoRatings {
  id               String   @id @default(cuid())
  symbol           String
  timestamp        DateTime
  rating           Decimal  @db.Decimal(10, 4)
  ratingDeviation  Decimal  @db.Decimal(10, 4)
  volatility       Decimal  @db.Decimal(10, 6)
  performanceScore Decimal  @db.Decimal(3, 2)
  createdAt        DateTime @default(now())

  @@unique([symbol, timestamp])
  @@index([symbol, timestamp])
  @@index([timestamp])
  @@map("glicko_ratings")
}

// Z-score history for live trading signals
model ZScoreHistory {
  id                   String   @id @default(cuid())
  symbol               String
  timestamp            DateTime
  zScore               Decimal  @db.Decimal(10, 6)
  rating               Decimal  @db.Decimal(10, 4)
  movingAverageZScore  Decimal? @db.Decimal(10, 6)
  zScoreThreshold      Decimal  @db.Decimal(5, 2)
  movingAveragesPeriod Int
  isEnabledForTrading  Boolean  @default(false)
  createdAt            DateTime @default(now())

  @@unique([symbol, timestamp])
  @@index([symbol, timestamp])
  @@index([timestamp])
  @@index([isEnabledForTrading])
  @@map("zscore_history")
}

// Live/paper trading orders
model ProductionOrders {
  id                   String   @id @default(cuid())
  orderId              String   @unique
  symbol               String
  side                 OrderSide
  type                 String
  quantity             Decimal  @db.Decimal(20, 8)
  price                Decimal  @db.Decimal(20, 8)
  stopPrice            Decimal? @db.Decimal(20, 8)
  timeInForce          String
  status               String
  executedQty          Decimal  @db.Decimal(20, 8)
  cummulativeQuoteQty  Decimal  @db.Decimal(20, 8)
  time                 DateTime
  updateTime           DateTime
  isWorking            Boolean
  origQuoteOrderQty    Decimal  @db.Decimal(20, 8)
  createdAt            DateTime @default(now())

  @@index([symbol, time])
  @@index([status])
  @@map("production_orders")
}

enum OrderSide {
  BUY
  SELL
}